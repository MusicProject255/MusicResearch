---
title: "MusicDatabase"
author: Collin Smith, Conor Burrows, Jake Luedtke, Nicholas Melon
date: "January 25, 2017"
output: html_document
---
#Overview
  
In our group our main focus is to determine what genre is the most popular in each decade starting with 1900 and going up to 2016. We also are going to look at which genres are more popular in eruope compared to the U.S and if the words in a song title have a effect on how popular a song is. We are going to use music brainz to get the genre of a song, it's mood quality, and tempo. With this information we will be able to see the trends better in preffered music choice for each decade. In the end we may use the database to make a simple song finder based on your taste in genre, tempo, and mood.

## First Steps: Getting data and Doing stuff

```{r}
library(stringr)
#Get dataset and look at name and title
allsongs <- read.csv("tsort-chart-2-6-0013.csv")
nsongs <- allsongs[,1:2]
#Set as characters
nnsongs <- as.character(nsongs$name)
#Make sure song names are in correct format
lsongs <- tolower(nnsongs)
lsong <- str_extract_all(lsongs, boundary("word"))

#test <- head(lsong, n = 20)
#Empty list for words
words <- list()
#Function looks at song titles, splits them up into words, adds them to a list and keeps track of number 
dtf <- data.frame()
for (x in 1:length(lsong)){
  title <- lsong[[x]]
  for (y in 1:length(title)){
    word <- title[[y]]
    if(exists(word, words)){
      words[[word]] <- words[[word]] + 1
    }else{
      words[[word]] <- 1
    }
  }
}

#Formatting Data and saving
mdf <- as.data.frame(words)
gmdf <- t(mdf)
colnames(gmdf) <- c("Instances")
write.table(gmdf, file = "songvalues.csv")

#Function to 
```

## Various Data Cleaning, Adding Decade Group Variable

```{r}
# Read the updated CSV
chart <- read.csv("chart.csv")

# Cleaning year--replace unknowns with NAs, convert to numeric
chart$year[which(as.character(chart$year) == "unknown")] <- NA
chart$year <- as.numeric(as.character(chart$year))

# Get decade from year
findDecade <- function(year) {
  after1900 <- year-1900
  if (is.na(year)) {
    decade <- NA # Account for NAs
  } else if (after1900 >= 100) {
    decade <- 2000 # Assign 2000 to anything 21st century
  } else {
    tens <- after1900 %/% 10
    decade <- 1900 + 10*tens
  }
  return(decade)
}

decades <- unlist(lapply(chart$year, findDecade))
chart$decade <- decades

# update csv
write.csv(chart, "chart.csv")


```

