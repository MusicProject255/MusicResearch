---
title: "MusicDatabase"
author: Collin Smith, Conor Burrows, Jake Luedtke, Nicholas Melon
date: "January 25, 2017"
output: html_document
---
#Overview
  
In our group our main focus is to determine what genre is the most popular in each decade starting with 1900 and going up to 2016. We also are going to look at which genres are more popular in eruope compared to the U.S and if the words in a song title have a effect on how popular a song is. We are going to use music brainz to get the genre of a song, it's mood quality, and tempo. With this information we will be able to see the trends better in preffered music choice for each decade. In the end we may use the database to make a simple song finder based on your taste in genre, tempo, and mood.


##Code used to get data
```{r eval=FALSE}
library(stringr)
#Get dataset and look at name and title
allsongs <- read.csv("tsort-chart-2-6-0013.csv")
#nsongs <- allsongs[,1:2]
rsongs <- allsongs[,1:3]
justsongs<- rsongs[(rsongs$type=="song"),]
justalbums <- rsongs[(rsongs$type=="album"),]
#Set as characters
csongs <- as.character(justsongs$name)
calbums <- as.character(justalbums$name)
#Make sure song names are in correct format
csongs <- tolower(csongs)
csongs <- str_extract_all(csongs, boundary("word"))
calbums <- tolower(calbums)
calbums <- str_extract_all(calbums, boundary("word"))


#Empty list for words
words <- list()
#Function looks at song titles, splits them up into words, adds them to a list and keeps track of number 
dtf <- data.frame()
for (x in 1:length(csongs)){
  title <- csongs[[x]]
  for (y in 1:length(title)){
    word <- title[[y]]
    if(exists(word, words)){
      words[[word]] <- words[[word]] + 1
    }else{
      words[[word]] <- 1
    }
  }
}
worda <- list()
#Function looks at song titles, splits them up into words, adds them to a list and keeps track of number
top5 <- as.character(top5000$name)
#Make sure song names are in correct format
top5 <- tolower(top5)
top5 <- str_extract_all(csongs, boundary("word"))
dtfa <- data.frame()
for (b in 1:length(calbums)){
  titlea <- calbums[[b]]
  for (c in 1:length(titlea)){
    aword <- titlea[[c]]
    if(exists(aword, worda)){
      worda[[aword]] <- worda[[aword]] + 1
    }else{
      worda[[aword]] <- 1
    }
  }
}

#Formatting Data and saving
mdf <- as.data.frame(words)
gmdf <- t(mdf)
colnames(gmdf) <- c("Instances")
write.table(gmdf, file = "songvalues.csv")
#formatting album data
mdfa <- as.data.frame(worda)
gmdfa <- t(mdfa)
colnames(gmdfa) <- c("Instances")
write.table(gmdfa, file = "albumvalues.csv")

top5 <- as.character(top5000$name)
top5 <- tolower(top5)
top5 <- str_extract_all(csongs, boundary("word"))
wordcount <- function(list){
  words <<- list()
  dtf <<- data.frame()
  for (x in 1:length(list)){
    title <<- list[[x]]
      for (y in 1:length(title)){
        word <<- title[[y]]
        if(exists(word, words)){
          words[[word]] <<- words[[word]] + 1
    }   else{
          words[[word]] <<- 1
    }
  }
  }
}
mdf <- as.data.frame(words)
gmdf <- t(mdf)
colnames(gmdf) <- c("Instances")
write.table(gmdf, file = "songvalues5000.csv")


#Search through 5000 for words and get their values
corectv5tes$word <- as.character(corectv5tes$word)
withztes$name <- as.character(withztes$name)
corectv5tes$word <- str_extract_all(corectv5tes$word, boundary("word"))
withztes$name <- tolower(withztes$name)
corectv5tes$word <- str_extract_all(corectv5tes$word, boundary("word"))


colnames(corectv5[3:6]) <- c("U.S","Eng","Eur","Row")
score <- 0
mean <- 0
#Replaced the columns each time
for (x in 1:3452){
  #doesn't return duplicates
  wappear <- grep(corectv5tes$word[[x]], withztes$name)
  for(y in wappear){
    score <- sum(withztes$z_row[[y]], na.rm = TRUE)
    mean <- mean + 1
    }
  scorer <- (score/mean)
  corectv5tes$Row[[x]] <- scorer
  score <- 0
      
    
  }
case <- corectv5tes
#wasn't formatted correctly so used original songs
valuetable <- corectv5tes[,3:6]
corectv5help[,3:6] <- valuetable
write.table(corectv5help,"5000popularitywords.csv")


#Didn't work out for meta data
dat <-  readLines("metadata5000e.txt")
dats <- str_split(dat, ':')
#9,22/28, 71/74/77, 83
#Mood, Tempo, Stlye, Male or Female
datsq <- lapply(dats, noquote)
#datsqe <- str_extract_all(datsq, boundary("word"))
#tese <- unlist(datsq)
#sapply(datsq[[7]], grepl, "mood")
datsq[[1]] <- NULL
#tester <- datsq[[1]]
emptyl <- list()
nob <- list()
for(x in 1:length(datsq)){
  nob[[x]] <- gsub("\\{|\\}", "", datsq[[x]])
}
nextes <- nob[[1]]

```

##Formating metadata
```{r}
top5meta <- read.csv("top5000plus.csv")
top5meta[,1:2] <- NULL
colnames(top5meta) <- 
c("artist" ,"name", "year","finalscore","rawusa","raweng","raweur","rawrow","zusa","zeng","zeur","zrow", "decade","mood1","mood2","artistera1","artistera2","tempo1","exacttempo","tempo2","artistorigin1","artistoriginspecific","artistorigin2","artistorigin4","genre1","genreSpec","genre2","artisttype1",
"artisttype2")
tmpochange <- top5meta$tempo1
tmpochange <- gsub(" Tempo", "" ,tmpochange)
top5meta$tempo1 <- tmpochange

```

##View data
```{r}
withzright  <- read.csv("top5000withz.csv")
head(withzright)
values5000right <- read.csv("songvalues5000.csv")
head(values5000right)
corectv5right <- read.csv("5000popularitywords.csv")
head(corectv5right)
```
